#!/usr/bin/env ruby
$:.unshift(File.join(File.dirname(__FILE__), '../lib'))
require 'optparse'
require 'client'

module Client

  USAGE = 'usage: blob_client [OPTIONS], try -h for more options'

  class << self
    def initialize
      @client = VCAP::BlobStore::Client.new({"endpoint" => "http://localhost:9999",
                                                "user" => "admin",
                                                "password" => "admin"})

    end

    def parse_options
      options = OptionParser.new do |opts|
          opts.banner = USAGE

          opts.on("-p", "--put string", "Add string to blob store.") do |opt|
            @client.create(opt)
          end

          opts.on("-c", "--create PATH", "Upload FILE to blob store.") do |opt|
            path = opt
            raise "Invalid file path #{path}." unless File.exists?(path)
          end

          opts.on("-d", "--delete KEY", "Delete object KEY.") do |opt|
            @client.delete(opt)
          end

          opts.on("-g", "--get KEY[,PATH]", "Get Object with KEY, optionally store to PATH.") do
            puts @client.get(opt)
          end

          opts.on("-h", "--help", "Help") do
            puts opts
            exit
          end
      end
      options.parse!(ARGV)
    end
  end
  if ARGV.length == 0
    puts USAGE
    exit
  end
  parse_options

end
