#!/usr/bin/env ruby

require "shellwords"
require "warden/client"
require "readline"
require "yajl"

include Shellwords

def prompt(str)
  STDOUT.print "%s> " % str
  STDOUT.flush
  STDIN.gets
end

#setup client
client = Warden::Client.new("/tmp/warden.sock")
client.connect

#auto completion
COMMAND_LIST = ['ping', 'create', 'stop', 'destroy', 'spawn', 'link', 'run', 'net', 'limit', 'info', 'list']

comp = proc { |s| COMMAND_LIST.grep( /^#{Regexp.escape(s)}/ ) }

Readline.completion_append_character = " "
Readline.completion_proc = comp

while line = Readline.readline('warden> ', true)

  words = shellwords(line)
  next if words.empty?

  # Issue command
  client.write(words)
  begin
  STDOUT.puts client.read.inspect
  rescue  => e
    puts e.message
  end
end
