# THIS FILE HAS BEEN GENERATED BY CHEF
# ANY MANUAL MODIFICATIONS WILL BE OVERWRITTEN
# mongodb.conf

# Note: if you run mongodb as a non-root user (recommended) you may
# need to create and set permissions for this directory manually,
# e.g., if the parent directory isn't mutable by the mongodb user.

<%
	config = node[:mongodb][@server_type]

	[
		# :auth, # authentication
		:bind_ip,
		:cpu, # Enables periodic logging of CPU utilization and I/O wait
		:datadir,
		:dbpath,
		# Set oplogging level where n is
		#   0=off (default)
		#   1=W
		#   2=R
		#   3=both
		#   7=W+some reads
		:diaglog,
    :logappend,
		:logpath, # where to log
		:nocursors, # Diagnostic/debugging option
		:nohints, # Igonore query hints
		:nohttpinterface, # Disable the HTTP interface (Defaults to localhost:27018).
		:noprealloc, # Disable data file preallocation.
		:noscripting, # Turns off server-side scripting.  This will result in greatly limited functionality
		:notablescan, # Turns off table scans.  Any query that would do a table scan fails.
		:nssize, # Specify .ns file size for new databases.
		:objcheck, # Inspect all client data for validity on receipt (useful for developing drivers)
		:port,
		:quota, # Enable db quota management
		:replSet, # replica set name
		:verbose, # Verbose logging output.
	].each do |option|
		if config[option] && !config[option].empty?
%>
<%= option %> = <%= config[option] %>
<%
		end
	end
%>

<% if config[:auth] %>
# Turn on/off security. Off is currently the default
# Not sure if this was fixed, but auth=false didn't use to work
auth = true
<% else %>
noauth = true
<% end %>

<% if config[:mms] %>
  # Accout token for Mongo monitoring server.
  mms-token = <%= config[:token] %>

  # Server name for Mongo monitoring server.
  mms-name = <%= config[:name] %>

  # Ping interval for Mongo monitoring server.
  mms-interval = <%= config[:interval] %>
<% end %>

<% if config[:replication] %>
  # Replication Options
  # in replicated mongo databases, specify here whether this is a slave or master
  <% if config[:slave] %>
  slave = <%= config[:slave] %>
  source = <%= config[:slave_source] %>

  # Slave only: specify a single database to replicate
  <% unless config[:slave_only].empty? %>
  only = <%= config[:slave_only] %>
  <% end %>

  <% end %>

  <% if config[:master] %>
  master = <%= config[:master] %>
  <% end %>

  # Automatically resync if slave data is stale
  <%= "autoresync" if config[:autoresync] %>
  # Custom size for replication operation log.
  oplogSize = <%= config[:oplogsize] %>
  # Size limit for in-memory storage of op ids.
  opIdMem = <%= config[:opidmem] * 1024 * 1024 %>
<% end %>
